/**
 * Leaflet Panel Layers v1.2.7 - 2019-11-21
 *
 * Copyright 2019 Stefano Cudini
 * stefano.cudini@gmail.com
 * http://labs.easyblog.it/
 *
 * Licensed under the MIT license.
 *
 * Demos:
 * http://labs.easyblog.it/maps/leaflet-panel-layers/
 *
 * Source:
 * git+https://github.com/Istador/leaflet-panel-layers.git
 *
 */
!function(e){if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)module.exports=e(require("leaflet"));else{if(void 0===window.L)throw"Leaflet must be loaded first";e(window.L)}}(function(h){return h.Control.PanelLayers=h.Control.Layers.extend({includes:"1"===h.version[0]?h.Evented.prototype:h.Mixin.Events,options:{compact:!1,compactOffset:0,collapsed:!1,autoZIndex:!0,collapsibleGroups:!1,groupCheckboxes:!0,buildItem:null,title:"",className:"",position:"topright"},initialize:function(e,t,a){var i,s,r,n;for(i in h.setOptions(this,a),this._layers=[],this._groups={},this._items={},this._layersActives=[],this._lastZIndex=0,this._handlingClick=!1,this.className="leaflet-panel-layers",e)if((r=e[i]).group&&r.layers)for(s in n=r.collapsed||!1,r.layers)this._addLayer(r.layers[s],!1,r.group,n);else this._addLayer(e[i],!1);for(i in t)if((r=t[i]).group&&r.layers)for(s in n=r.collapsed||!1,r.layers)this._addLayer(r.layers[s],!0,r.group,n);else this._addLayer(r,!0)},onAdd:function(e){for(var t in this._layersActives)e.addLayer(this._layersActives[t]);return h.Control.Layers.prototype.onAdd.call(this,e),this._map.on("resize",function(e){this._updateHeight(e.newSize.y)},this),this._onInputClick(),this._container},addBaseLayer:function(e,t,a){return e.name=t||e.name||"",this._addLayer(e,!1,a),this._update(),this},addOverlay:function(e,t,a){return e.name=t||e.name||"",this._addLayer(e,!0,a),this._update(),this},removeLayer:function(e){var t=e.hasOwnProperty("layer")?this._layerFromDef(e):e;return this._map.removeLayer(t),h.Control.Layers.prototype.removeLayer.call(this,t),this},clearLayers:function(){for(var e in this._layers)this.removeLayer(this._layers[e])},_layerFromDef:function(e){for(var t in this._layers){var a=h.stamp(this._layers[t].layer);if(this._getLayer(a).name===e.name)return this._getLayer(a).layer}},_update:function(){this._groups={},this._items={},h.Control.Layers.prototype._update.call(this)},_getLayer:function(e){for(var t in this._layers){var a=this._layers[t];if(a&&a.id==e)return a}},_addLayer:function(e,t,a,i){if(!e.layer)throw new Error("layer not defined in item: "+(e.name||""));e.layer instanceof h.Class||!e.layer.type||!e.layer.args||(e.layer=this._getPath(h,e.layer.type).apply(h,e.layer.args)),e.hasOwnProperty("id")||(e.id=h.stamp(e.layer)),e.active&&this._layersActives.push(e.layer),this._layers.push(h.Util.extend(e,{collapsed:i,overlay:t,group:a})),this.options.autoZIndex&&e.layer&&e.layer.setZIndex&&(this._lastZIndex++,e.layer.setZIndex(this._lastZIndex))},_createItem:function(e){var t,a,i,s=this;t=h.DomUtil.create("div",this.className+"-item"+(e.active?" active":"")),i=this._map.hasLayer(e.layer),e.overlay?((a=h.DomUtil.create("input",this.className+"-selector")).type="checkbox",a.defaultChecked=i):a=this._createRadioElement("leaflet-base-layers",i,e),a.value=e.id,a.layerId=e.id,a.id=e.id,a._layer=e,h.DomEvent.on(a,"click",function(e){s._onInputClick(),s.fire(e.target.checked?"panel:selected":"panel:unselected",e.target._layer)},this);var r=h.DomUtil.create("label",this.className+"-title"),n=h.DomUtil.create("span");if(n.innerHTML=e.name||"",e.icon){var o=h.DomUtil.create("i",this.className+"-icon");"string"==typeof e.icon?o.innerHTML=e.icon||"":o.appendChild(e.icon),r.appendChild(o)}if(r.appendChild(a),r.appendChild(n),t.appendChild(r),this.options.buildItem){var l=this.options.buildItem.call(this,e);if("string"==typeof l){var c=h.DomUtil.create("div");c.innerHTML=l,t.appendChild(c.firstChild)}else t.appendChild(l)}return this._items[a.value]=t},_createRadioElement:function(e,t,a){var i=document.createElement("div");return i.innerHTML='<input type="radio" class="'+this.className+'-selector" name="'+e+'" id="'+a.id+'"'+(t?' checked="checked"':"")+" />",i.firstChild},_addItem:function(e){var t,a=e.overlay?this._overlaysList:this._baseLayersList;return e.group&&(e.group.hasOwnProperty("name")||(e.group={name:e.group}),this._groups[e.group.name]||(this._groups[e.group.name]=this._createGroup(e.group,!0===e.collapsed,e.overlay)),a.appendChild(this._groups[e.group.name]),a=this._groups[e.group.name]),t=this._createItem(e),a.appendChild(t),t},_createGroup:function(e,t,a){var i,s,r=h.DomUtil.create("div",this.className+"-group"),n=h.DomUtil.create("label",this.className+"-grouplabel",r);return this.options.collapsibleGroups&&(h.DomUtil.addClass(r,"collapsible"),!1===t&&h.DomUtil.addClass(r,"expanded"),(i=h.DomUtil.create("i",this.className+"-icon",n)).innerHTML=!0===t?" + ":" - ",h.DomEvent.on(n,"click",function(e){e.stopPropagation(),e.preventDefault(),h.DomUtil.hasClass(r,"expanded")?(h.DomUtil.removeClass(r,"expanded"),i.innerHTML=" + "):(h.DomUtil.addClass(r,"expanded"),i.innerHTML=" - "),this._updateHeight()},this)),h.DomUtil.create("span",this.className+"-title",n).innerHTML=e.name,a&&this.options.groupCheckboxes&&((s=h.DomUtil.create("input",this.className+"-selector",n)).type="checkbox",s.value="group",s.name=e.name,s.defaultChecked=!1,h.DomEvent.on(s,"click",this._onGroupClick,this)),r},_onGroupClick:function(e){var t,a,i=e.target,s=this._form.getElementsByClassName(this.className+"-selector"),r=s.length,n=[];e.stopPropagation();for(var o=0;o<r;o++)"group"!=(t=s[o]).value&&(a=this._getLayer(t.value)).group&&a.group.name===i.name&&t.checked!==i.checked&&(n.push(t),t.checked=i.checked);for(var l in this._onInputClick(),n)this.fire(i.checked?"panel:selected":"panel:unselected",n[l]._layer)},_onInputClick:function(){var e,t,a,i,s=this._form.getElementsByClassName(this.className+"-selector"),r=s.length,n={};for(a in this._groups)n[a]={input:null,checked:0,total:0};this._handlingClick=!0;for(var o=0;o<r;o++)"group"!=(e=s[o]).value?((t=this._getLayer(e.value)).group&&(n[t.group.name].total++,e.checked&&n[t.group.name].checked++),e.checked&&!this._map.hasLayer(t.layer)?(h.DomUtil.addClass(e.parentNode.parentNode,"active"),this._map.addLayer(t.layer)):!e.checked&&this._map.hasLayer(t.layer)&&(h.DomUtil.removeClass(e.parentNode.parentNode,"active"),this._map.removeLayer(t.layer))):n[e.name].input=e;for(a in this._handlingClick=!1,n)(i=n[a]).input&&(i.checked===i.total?(i.input.indeterminate=!1,i.input.checked=!0):0===i.checked?(i.input.indeterminate=!1,i.input.checked=!1):(i.input.indeterminate=!0,i.input.checked=.5<=i.checked/i.total));this._refocusOnMap()},_initLayout:function(){var e=this._container=h.DomUtil.create("div",this.className);if(this.options.compact&&h.DomUtil.addClass(e,"compact"),e.setAttribute("aria-haspopup",!0),h.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),this.options.className&&h.DomUtil.addClass(e,this.options.className),this._section=this._form=h.DomUtil.create("form",this.className+"-list"),this._updateHeight(),this.options.collapsed?(h.Browser.android?h.DomEvent.on(e,"click",this._expand,this):h.DomEvent.on(e,"mouseenter",this._expand,this).on(e,"mouseleave",this._collapse,this),this._map.on("click",this._collapse,this)):this._expand(),this._baseLayersList=h.DomUtil.create("div",this.className+"-base",this._form),this._separator=h.DomUtil.create("div",this.className+"-separator",this._form),this._overlaysList=h.DomUtil.create("div",this.className+"-overlays",this._form),this.options.title){var t=h.DomUtil.create("label",this.className+"-title");t.innerHTML="<span>"+this.options.title+"</span>",e.appendChild(t)}e.appendChild(this._form)},_updateHeight:function(e){e=e||this._map.getSize().y,this.options.compact?this._form.style.maxHeight=e-this.options.compactOffset+"px":this._form.style.height=e+"px"},_expand:function(){h.DomUtil.addClass(this._container,"expanded")},_collapse:function(){this._container.className=this._container.className.replace("expanded","")},_getPath:function(e,t){var a=t.split("."),i=a.pop(),s=a.length,r=a[0],n=1;if(0<s)for(;(e=e[r])&&n<s;)r=a[n++];if(e)return e[i]}}),h.control.panelLayers=function(e,t,a){return new h.Control.PanelLayers(e,t,a)},h.Control.PanelLayers});