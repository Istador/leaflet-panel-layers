/**
 * Leaflet Panel Layers v1.2.8 - 2021-02-13
 *
 * Copyright 2021 Stefano Cudini
 * stefano.cudini@gmail.com
 * http://labs.easyblog.it/
 *
 * Licensed under the MIT license.
 *
 * Demos:
 * http://labs.easyblog.it/maps/leaflet-panel-layers/
 *
 * Source:
 * git+https://github.com/Istador/leaflet-panel-layers.git
 *
 */
!function(e){if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)module.exports=e(require("leaflet"));else{if(void 0===window.L)throw"Leaflet must be loaded first";e(window.L)}}(function(l){return l.Control.PanelLayers=l.Control.Layers.extend({includes:"1"===l.version[0]?l.Evented.prototype:l.Mixin.Events,options:{compact:!1,compactOffset:0,collapsed:!1,autoZIndex:!0,collapsibleGroups:!1,groupCheckboxes:!0,buildItem:null,title:"",className:"",position:"topright"},initialize:function(e,t,a){var i,s,r,n;for(i in l.setOptions(this,a),this._layers=[],this._groups={},this._items={},this._layersActives=[],this._lastZIndex=0,this._handlingClick=!1,this.className="leaflet-panel-layers",e)if((r=e[i]).group&&r.layers)for(s in n=r.collapsed||!1,r.layers)this._addLayer(r.layers[s],!1,r.group,n);else this._addLayer(e[i],!1);for(i in t)if((r=t[i]).group&&r.layers)for(s in n=r.collapsed||!1,r.layers)this._addLayer(r.layers[s],!0,r.group,n);else this._addLayer(r,!0)},onAdd:function(e){for(var t in this._layersActives)e.addLayer(this._layersActives[t]);return l.Control.Layers.prototype.onAdd.call(this,e),this._map.on("resize",function(e){this._updateHeight(e.newSize.y)},this),this._onInputClick(),this._container},addBaseLayer:function(e,t,a){return e.name=t||e.name||"",this._addLayer(e,!1,a),this._update(),this},addOverlay:function(e,t,a){return e.name=t||e.name||"",this._addLayer(e,!0,a),this._update(),this},removeLayer:function(e){e=e.hasOwnProperty("layer")?this._layerFromDef(e):e;return this._map.removeLayer(e),l.Control.Layers.prototype.removeLayer.call(this,e),this},clearLayers:function(){for(var e in this._layers)this.removeLayer(this._layers[e])},_layerFromDef:function(e){for(var t in this._layers){var a=l.stamp(this._layers[t].layer);if(this._getLayer(a).name===e.name)return this._getLayer(a).layer}},_update:function(){this._groups={},this._items={},l.Control.Layers.prototype._update.call(this)},_getLayer:function(e){for(var t in this._layers){var a=this._layers[t];if(a&&a.id==e)return a}},_addLayer:function(e,t,a,i){if(!e.layer)throw new Error("layer not defined in item: "+(e.name||""));e.layer instanceof l.Class||!e.layer.type||!e.layer.args||(e.layer=this._getPath(l,e.layer.type).apply(l,e.layer.args)),e.hasOwnProperty("id")||(e.id=l.stamp(e.layer)),e.active&&this._layersActives.push(e.layer),this._layers.push(l.Util.extend(e,{collapsed:i,overlay:t,group:a})),this.options.autoZIndex&&e.layer&&e.layer.setZIndex&&(this._lastZIndex++,e.layer.setZIndex(this._lastZIndex))},_createItem:function(e){var t,a=this,i=l.DomUtil.create("div",this.className+"-item"+(e.active?" active":"")),s=this._map.hasLayer(e.layer);e.overlay?((t=l.DomUtil.create("input",this.className+"-selector")).type="checkbox",t.defaultChecked=s):t=this._createRadioElement("leaflet-base-layers",s,e),t.value=e.id,t.layerId=e.id,t.id=e.id,t._layer=e,l.DomEvent.on(t,"click",function(e){a._onInputClick(),a.fire(e.target.checked?"panel:selected":"panel:unselected",e.target._layer)},this);var r=l.DomUtil.create("label",this.className+"-title"),n=l.DomUtil.create("span");return n.innerHTML=e.name||"",e.icon&&(s=l.DomUtil.create("i",this.className+"-icon"),"string"==typeof e.icon?s.innerHTML=e.icon||"":s.appendChild(e.icon),r.appendChild(s)),r.appendChild(t),r.appendChild(n),i.appendChild(r),this.options.buildItem&&("string"==typeof(r=this.options.buildItem.call(this,e))?((e=l.DomUtil.create("div")).innerHTML=r,i.appendChild(e.firstChild)):i.appendChild(r)),this._items[t.value]=i},_createRadioElement:function(e,t,a){var i=document.createElement("div");return i.innerHTML='<input type="radio" class="'+this.className+'-selector" name="'+e+'" id="'+a.id+'"'+(t?' checked="checked"':"")+" />",i.firstChild},_addItem:function(e){var t=e.overlay?this._overlaysList:this._baseLayersList;return e.group&&(e.group.hasOwnProperty("name")||(e.group={name:e.group}),this._groups[e.group.name]||(this._groups[e.group.name]=this._createGroup(e.group,!0===e.collapsed,e.overlay)),t.appendChild(this._groups[e.group.name]),t=this._groups[e.group.name]),e=this._createItem(e),t.appendChild(e),e},_createGroup:function(e,t,a){var i,s=l.DomUtil.create("div",this.className+"-group"),r=l.DomUtil.create("label",this.className+"-grouplabel",s);return this.options.collapsibleGroups&&(l.DomUtil.addClass(s,"collapsible"),!1===t&&l.DomUtil.addClass(s,"expanded"),(i=l.DomUtil.create("i",this.className+"-icon",r)).innerHTML=!0===t?" + ":" - ",l.DomEvent.on(r,"click",function(e){e.stopPropagation(),e.preventDefault(),l.DomUtil.hasClass(s,"expanded")?(l.DomUtil.removeClass(s,"expanded"),i.innerHTML=" + "):(l.DomUtil.addClass(s,"expanded"),i.innerHTML=" - "),this._updateHeight()},this)),l.DomUtil.create("span",this.className+"-title",r).innerHTML=e.name,a&&this.options.groupCheckboxes&&((r=l.DomUtil.create("input",this.className+"-selector",r)).type="checkbox",r.value="group",r.name=e.name,r.defaultChecked=!1,l.DomEvent.on(r,"click",this._onGroupClick,this)),s},_onGroupClick:function(e){var t,a,i=e.target,s=this._form.getElementsByClassName(this.className+"-selector"),r=s.length,n=[];e.stopPropagation();for(var o,l=0;l<r;l++)"group"!=(t=s[l]).value&&(a=this._getLayer(t.value)).group&&a.group.name===i.name&&t.checked!==i.checked&&(n.push(t),t.checked=i.checked);for(o in this._onInputClick(),n)this.fire(i.checked?"panel:selected":"panel:unselected",n[o]._layer)},_onInputClick:function(){var e,t,a,i,s=this._form.getElementsByClassName(this.className+"-selector"),r=s.length,n={};for(a in this._groups)n[a]={input:null,checked:0,total:0};this._handlingClick=!0;for(var o=0;o<r;o++)"group"!=(e=s[o]).value?((t=this._getLayer(e.value)).group&&(n[t.group.name].total++,e.checked&&n[t.group.name].checked++),e.checked&&!this._map.hasLayer(t.layer)?(l.DomUtil.addClass(e.parentNode.parentNode,"active"),this._map.addLayer(t.layer)):!e.checked&&this._map.hasLayer(t.layer)&&(l.DomUtil.removeClass(e.parentNode.parentNode,"active"),this._map.removeLayer(t.layer))):n[e.name].input=e;for(a in this._handlingClick=!1,n)(i=n[a]).input&&(i.checked===i.total?(i.input.indeterminate=!1,i.input.checked=!0):0===i.checked?(i.input.indeterminate=!1,i.input.checked=!1):(i.input.indeterminate=!0,i.input.checked=.5<=i.checked/i.total));this._refocusOnMap()},_initLayout:function(){var e,t=this._container=l.DomUtil.create("div",this.className);this.options.compact&&l.DomUtil.addClass(t,"compact"),t.setAttribute("aria-haspopup",!0),l.DomEvent.disableClickPropagation(t).disableScrollPropagation(t),this.options.className&&l.DomUtil.addClass(t,this.options.className),this._section=this._form=l.DomUtil.create("form",this.className+"-list"),this._updateHeight(),this.options.collapsed?(l.Browser.android?l.DomEvent.on(t,"click",this._expand,this):l.DomEvent.on(t,"mouseenter",this._expand,this).on(t,"mouseleave",this._collapse,this),this._map.on("click",this._collapse,this)):this._expand(),this._baseLayersList=l.DomUtil.create("div",this.className+"-base",this._form),this._separator=l.DomUtil.create("div",this.className+"-separator",this._form),this._overlaysList=l.DomUtil.create("div",this.className+"-overlays",this._form),this.options.title&&((e=l.DomUtil.create("label",this.className+"-title")).innerHTML="<span>"+this.options.title+"</span>",t.appendChild(e)),t.appendChild(this._form)},_updateHeight:function(e){e=e||this._map.getSize().y,this.options.compact?this._form.style.maxHeight=e-this.options.compactOffset+"px":this._form.style.height=e+"px"},_expand:function(){l.DomUtil.addClass(this._container,"expanded")},_collapse:function(){this._container.className=this._container.className.replace("expanded","")},_getPath:function(e,t){var a=t.split("."),t=a.pop(),i=a.length,s=a[0],r=1;if(0<i)for(;(e=e[s])&&r<i;)s=a[r++];if(e)return e[t]}}),l.control.panelLayers=function(e,t,a){return new l.Control.PanelLayers(e,t,a)},l.Control.PanelLayers});